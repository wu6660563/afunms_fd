<%@page language="java" contentType="text/html;charset=GB2312"%>
<%@page import="com.afunms.flex.networkTopology.NetworkMonitor"%>
<%@page import="org.apache.commons.collections.functors.WhileClosure"%>
<%@page import="org.apache.commons.lang.SystemUtils"%>
<%@page import="org.apache.commons.net.DefaultDatagramSocketFactory"%>
<%@ include file="/include/globe.inc"%>
<%@page import="com.afunms.topology.util.NodeHelper"%>
<%@page import="com.afunms.inform.util.SystemSnap"%>
<%@page import="com.afunms.topology.dao.ManageXmlDao"%>
<%@page import="com.afunms.topology.model.ManageXml"%>
<%@page import="com.afunms.common.util.SessionConstant"%>
<%@page import="com.afunms.system.model.User"%>
<%@page import="com.afunms.system.vo.EventVo"%>
<%@page import="java.util.*"%>
<%@page import="com.afunms.initialize.ResourceCenter"%>
<%@page import="java.util.HashMap"%>
<%
  	String rootPath = request.getContextPath();
  	
  	HashMap datamap=(HashMap)session.getAttribute("datamap");
	String[][] tableData=(String[][])datamap.get("tabledata");
	String piedata=(String)datamap.get("piedata");
	String columndata=(String)datamap.get("columndata");
	String closedAlarmPicFile=(String)datamap.get("closedAlarmPicFile");
	String dayalarmData=(String)datamap.get("dayalarmData");
	String weekalarmData=(String)datamap.get("weekalarmData");
  	
  	User uservo = (User)session.getAttribute(SessionConstant.CURRENT_USER);
  	String menuTable = (String)request.getAttribute("menuTable");
  	List list = null;
  	Date c1=new Date();
	String timeFormat = "MM-dd HH:mm:ss";
	java.text.SimpleDateFormat timeFormatter = new java.text.SimpleDateFormat(timeFormat);
	List networklist = (List)session.getAttribute("networklist");
	List hostlist = (List)session.getAttribute("hostlist");
	String hostsize = "0";
	if(hostlist != null && hostlist.size()>0)hostsize=hostlist.size()+"";
	String dbsize = (String)session.getAttribute("dbsize");
	if(dbsize == null)dbsize="0";
	String securesize = (String)session.getAttribute("securesize");
	if(securesize == null)securesize="0";
	String storagesize = (String)session.getAttribute("storagesize");
	if(storagesize == null)storagesize="0";
	String servicesize = (String)session.getAttribute("servicesize");
	if(servicesize == null)servicesize="0";
	String midsize = (String)session.getAttribute("midsize");
	if(midsize == null)midsize="0";
	String routesize = (String)session.getAttribute("routesize");
	if(routesize == null)routesize="0";
	String switchsize = (String)session.getAttribute("switchsize");
	if(switchsize == null)switchsize="0";
	ManageXmlDao dao = new ManageXmlDao();
    ManageXml vo = (ManageXml)dao.findByView("1",uservo.getBusinessids());
    dao.close();
    String topo_name = "物理根图";
    String home_topo_view = "network.jsp";
    String zoom = "1";
    if(vo!=null){
        topo_name = vo.getTopoTitle();
        home_topo_view = vo.getXmlName();
        zoom = vo.getPercent()+"";
    }
    session.setAttribute(SessionConstant.HOME_TOPO_VIEW,home_topo_view); 
    ManageXmlDao mxdao = new ManageXmlDao();
    ManageXml mxvo = (ManageXml)mxdao.findByBusView("1",uservo.getBusinessids());
    
    //得到业务告警信息
    NetworkMonitor networkMonitor = new NetworkMonitor();
    Hashtable bussinessviewHash = networkMonitor.getBussinessviewHash();
%>

<%
	//默认选择该用户第一个所属业务作为跳转的treeBid

	//该所属业务中没有路由器，且该用户没有下一个所属业务，不跳转！
	User user = (User) session
			.getAttribute(SessionConstant.CURRENT_USER);
	String[] bids = user.getBusinessids().split(",");
	String defaultbid = "";
	for (String bid : bids) {
		if (bid != null && !bid.equals("")) {
			defaultbid = bid;
			break;
		}
	}
	//该所属业务中没有路由器，且该用户下一个所属业务中存在路由器，将该业务id作为treeBid,跳转！
	String treeBidRouter = defaultbid;
	String treeBidHost = defaultbid;
	String treeBidSwitch = defaultbid;
	String treeBidDb = defaultbid;
	String treeBidMid = defaultbid;
	String treeBidService = defaultbid;
	String treeBidSecu = defaultbid;
	Hashtable treeBidHash = (Hashtable) request
			.getAttribute("treeBidHash");
	if (treeBidHash != null) {
		if (treeBidHash.containsKey("treeBidRouter")) {
			treeBidRouter = (String) treeBidHash.get("treeBidRouter");
		}
		if (treeBidHash.containsKey("treeBidHost")) {
			treeBidHost = (String) treeBidHash.get("treeBidHost");
		}
		if (treeBidHash.containsKey("treeBidSwitch")) {
			treeBidSwitch = (String) treeBidHash.get("treeBidSwitch");
		}
		if (treeBidHash.containsKey("treeBidDb")) {
			treeBidDb = (String) treeBidHash.get("treeBidDb");
		}
		if (treeBidHash.containsKey("treeBidMid")) {
			treeBidMid = (String) treeBidHash.get("treeBidMid");
		}
		if (treeBidHash.containsKey("treeBidService")) {
			treeBidService = (String) treeBidHash.get("treeBidService");
		}
		if (treeBidHash.containsKey("treeBidSecu")) {
			treeBidSecu = (String) treeBidHash.get("treeBidSecu");
		}
	}

	String routepath = "/perform.do?action=monitornodelist&flag=1&category=net_router&treeBid="
			+ treeBidRouter;
	String switchpath = "/perform.do?action=monitornodelist&flag=1&category=net_switch&treeBid="
			+ treeBidSwitch;
	String hostpath = "/perform.do?action=monitornodelist&flag=1&category=net_server&treeBid="
			+ treeBidHost;
	String dbpath = "/db.do?action=list&flag=1&treeBid=" + treeBidDb;
	String midpath = "/middleware.do?action=list&flag=1&category=middleware&treeBid="
			+ treeBidMid;
	String servicepath = "/service.do?action=list&flag=1&treeBid="
			+ treeBidService;
	String securepath = "/perform.do?action=monitornodelist&flag=1&category=safeequip&treeBid="
			+ treeBidSecu;

	//存储链接路(暂时给定路由器的链接)   无测试环境<Task未完成>
	String storagepath = "/perform.do?action=monitornodelist&flag=1&category=net_router&treeBid="
			+ treeBidRouter;
%>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
		<link href="<%=rootPath%>/resource/css/global/global.css"
			rel="stylesheet" type="text/css" />

		<script language="JavaScript" type="text/javascript"
			src="<%=rootPath%>/include/navbar.js"></script>
		<script type="text/javascript"
			src="<%=rootPath%>/include/swfobject.js"></script>
		<script type="text/javascript"
			src="<%=rootPath%>/resource/xml/flush/amcolumn/swfobject.js"></script>
		<link rel="stylesheet" type="text/css"
			href="<%=rootPath%>/application/environment/resource/ext3.1/resources/css/ext-all.css" />
		<!-- GC -->
		<!-- LIBS -->
		<script type="text/javascript"
			src="<%=rootPath%>/application/environment/resource/ext3.1/adapter/ext/ext-base.js"></script>
		<!-- ENDLIBS -->
		<script type="text/javascript"
			src="<%=rootPath%>/application/environment/resource/ext3.1/ext-all.js"></script>
		<!-- EXT做的重点资源标签页home.js  css样式修改 -->
		<style type="text/css">
.x-tab-strip-top .x-tab-right {
	background-image: url("<%=rootPath%>/img/ext/tabs/tabs-sprite.gif");
}

.x-tab-strip-top .x-tab-left {
	background-image: url("<%=rootPath%>/img/ext/tabs/tabs-sprite.gif");
}

.x-tab-strip-top .x-tab-strip-inner {
	background-image: url("<%=rootPath%>/img/ext/tabs/tabs-sprite.gif");
}

.x-tab-panel-body {
	border-bottom-color: #EAEAEA;
	border-left-color: #EAEAEA;
	border-right-color: #EAEAEA;
	border-top-color: #EAEAEA;
}

.x-tab-panel-header {
	background-color: #EAEAEA;
	border-bottom-color: #EAEAEA;
	border-left-color: #EAEAEA;
	border-right-color: #EAEAEA;
	border-top-color: #EAEAEA;
}

.x-tab-panel-header-plain .x-tab-strip-spacer {
	background-color: #EAEAEA;
	border-bottom-color: #EAEAEA;
	border-left-color: #EAEAEA;
	border-right-color: #EAEAEA;
	border-top-color: #EAEAEA;
}

.x-panel {
	border-bottom-color: #EAEAEA;
	border-left-color: #EAEAEA;
	border-right-color: #EAEAEA;
	border-top-color: #EAEAEA;
}

.x-panel-body {
	border-bottom-color: #EAEAEA;
	border-left-color: #EAEAEA;
	border-right-color: #EAEAEA;
	border-top-color: #EAEAEA;
}

UL.x-tab-strip-top {
	background-color: #EAEAEA;
}
</style>
		<script type="text/javascript" src="<%=rootPath%>/js/home.js"></script>


		<script type="text/javascript">
		var show = true;
		var hide = false;
		//修改菜单的上下箭头符号
		function my_on(head,body)
		{
			var tag_a;
			for(var i=0;i<head.childNodes.length;i++)
			{
				if (head.childNodes[i].nodeName=="A")
				{
					tag_a=head.childNodes[i];
					break;
				}
			}
			tag_a.className="on";
		}
		function my_off(head,body)
		{
			var tag_a;
			for(var i=0;i<head.childNodes.length;i++)
			{
				if (head.childNodes[i].nodeName=="A")
				{
					tag_a=head.childNodes[i];
					break;
				}
			}
			tag_a.className="off";
		}
		//添加菜单	
		function initmenu()
		{
			var idpattern=new RegExp("^menu");
			var menupattern=new RegExp("child$");
			var tds = document.getElementsByTagName("div");
			for(var i=0,j=tds.length;i<j;i++){
				var td = tds[i];
				if(idpattern.test(td.id)&&!menupattern.test(td.id)){					
					menu =new Menu(td.id,td.id+"child",'dtu','100',show,my_on,my_off);
					menu.init();		
				}
			}
		
		}
	</script>

		<script type="text/javascript">
		
		function hideMenu(){
			var element = document.getElementById("container-menu-bar").parentElement;
			var display = element.style.display;
			if(display == "inline"){
				hideMenuBar();
			}else{
				showMenuBar();
			}
			//刷新tabpanel的宽度
			var tr_width = Ext.get("keybusiness_tr").getWidth()-1;
			Ext.get('tab_list_tr').setWidth(tr_width);
			Ext.get('tab_list').setWidth(tr_width);
			Ext.get('devicexn').setWidth(tr_width);
		}
		
		function showMenuBar(){
			var element = document.getElementById("container-menu-bar").parentElement;
			element.style.display = "inline";
		}
		
		function hideMenuBar(){
			var element = document.getElementById("container-menu-bar").parentElement;
			element.style.display = "none";
		}
		var fatherXML = "<%=home_topo_view%>";
		function redirectUrl(){
			if(fatherXML=="network.jsp"){
			    window.open('<%=rootPath%>/topology/network/index.jsp','window', 'toolbar=no,height=screen.height,width=screen.width,scrollbars=no,center=yes,resizable=yes');
		} else {
		    window.open('<%=rootPath%>/topology/submap/index.jsp?submapXml='+fatherXML,'window', 'toolbar=no,height=screen.height,width=screen.width,scrollbars=no,center=yes,resizable=yes');
			}
		}
	</script>

	</head>
	<body id="body" class="body" onload="initmenu();hideMenuBar();">
		<!-- 定义一个空div -->
		<span id="rootpath" value="<%=rootPath%>"></span>
		<form id="mainForm" method="post" name="mainForm">
			<table id="body-container" class="body-container">
				<tr>
					<td class="td-container-main">
						<table id="container-main" class="container-main">
							<tr>
								<td class="td-container-main-content">
									<table id="container-main-content"
										class="container-main-content" style="width: 99%" border="0">
										<%-- <tr>
											<td>
												<table id="content-header" class="content-header">
													<tr>
														<td align="left" width="5">
															<img src="<%=rootPath%>/common/images/right_t_01.jpg"
																width="5" height="29" />
														</td>
														<td class="content-title">
															系统快照
														</td>
														<td align="right">
															<img src="<%=rootPath%>/common/images/right_t_03.jpg"
																width="5" height="29" />
														</td>
													</tr>
												</table>
											</td>
										</tr>--%>
										<tr style="height: 7px; ">
											<td>
												<div></div>
											</td>
										</tr>
										<tr>
											<td>
												<table id="content-body" class="content-body"
													style="border-left: #737272 0px solid; border-right: #737272 0px solid;">
													<tr>
														<td>
															<table>
																<tr>
																	<!-- 设备快照 -->
																	<td width=50% align='center' height="300">
																		<table width=100% height="100%" border="0"
																			align='center'>
																			<tr valign="top">
																				<td>
																					<table id="content-header" class="content-header">
																						<tr>
																							<td align="left" width="5">
																								<img
																									src="<%=rootPath%>/common/images/right_t_01.jpg"
																									width="5" height="29" />
																							</td>
																							<td align='center' height="29"
																								class="content-title"
																								style="text-align: center;">
																								<b>设备快照</b>
																							</td>
																							<td align="right">
																								<img
																									src="<%=rootPath%>/common/images/right_t_03.jpg"
																									width="5" height="29" />
																							</td>
																						<tr>
																					</table>
																				</td>
																			</tr>
																			<tr>
																				<td width="100%">
																					<table width="100%">
																						<tr>
																							<td align="center">
																								<img
																									src="<%=rootPath%>/resource/<%=NodeHelper.getSnapStatusImage(SystemSnap
							.getRouterStatus(), 1)%>">
																								<br>
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=routepath%>');">路由器(<%=routesize%>)</a>
																							</td>
																							<td align="center">
																								<img
																									src="<%=rootPath%>/resource/<%=NodeHelper.getSnapStatusImage(SystemSnap
							.getSwitchStatus(), 2)%>">
																								<br>
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=switchpath%>');">交换机(<%=switchsize%>)</a>
																							</td>
																							<td align="center">
																								<img
																									src="<%=rootPath%>/resource/<%=NodeHelper.getSnapStatusImage(SystemSnap
							.getServerStatus(), 3)%>">
																								<br>
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=hostpath%>');">服务器(<%=hostsize%>)</a>
																							</td>
																							<td align="center">
																								<img
																									src="<%=rootPath%>/resource/<%=NodeHelper
							.getSnapStatusImage(SystemSnap.getDbStatus(), 4)%>">
																								<br>
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=dbpath%>');">数据库(<%=dbsize%>)</a>
																							</td>
																						</tr>
																						<tr>
																							<td>
																								<div style="height: 50px;"></div>
																							</td>
																						</tr>
																						<tr>
																							<td align="center">
																								<img
																									src="<%=rootPath%>/resource/<%=NodeHelper.getSnapStatusImage(SystemSnap
							.getMiddleStatus(), 5)%>">
																								<br>
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=midpath%>');">中间件(<%=midsize%>)</a>
																							</td>
																							<td align="center">
																								<img
																									src="<%=rootPath%>/resource/<%=NodeHelper.getSnapStatusImage(SystemSnap
							.getServiceStatus(), 6)%>">
																								<br>
																								<!--<img src="<%=rootPath%>/resource/image/service.gif" ><br>-->
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=servicepath%>');">服务(<%=servicesize%>)</a>
																							</td>
																							<td align="center">
																								<img
																									src="<%=rootPath%>/resource/<%=NodeHelper.getSnapStatusImage(SystemSnap
							.getFirewallStatus(), 7)%>">
																								<!--<img src="<%=rootPath%>/resource/image/topo/firewall/firewall.gif">-->
																								<br>
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=securepath%>');">安全(<%=securesize%>)</a>
																							</td>
																							<td align="center" bgcolor=#ffffff>
																								<img
																									src="<%=rootPath%>/resource/image/topo/storage.gif">
																								<br>
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=storagepath%>');">存储(<%=storagesize%>)</a>
																							</td>
																						</tr>
																						<tr>
																							<td>
																								<div style="height: 20px;"></div>
																							</td>
																						</tr>
																					</table>
																				<td>
																			</tr>
																			<tr valign="bottom">
																				<td>
																					<table id="content-footer" class="content-footer">
																						<tr>
																							<td>
																								<table width="100%" border="0" cellspacing="0"
																									cellpadding="0">
																									<tr>
																										<td align="left" valign="bottom">
																											<img
																												src="<%=rootPath%>/common/images/right_b_01.jpg"
																												width="5" height="12" />
																										</td>
																										<td></td>
																										<td align="right" valign="bottom">
																											<img
																												src="<%=rootPath%>/common/images/right_b_03.jpg"
																												width="5" height="12" />
																										</td>
																									</tr>
																								</table>
																							</td>
																						</tr>
																					</table>
																				</td>
																			</tr>
																		</table>
																	</td>
																	<td>
																		&nbsp;
																	</td>
																	<!-- 关键业务 -->
																	<td width=50% align='center' height="300">
																		<table width=100% height="100%" border="0"
																			align='center'>
																			<tr valign="top" id="keybusiness_tr">
																				<td>
																					<table id="content-header" class="content-header">
																						<tr>
																							<td align="left" width="5">
																								<img
																									src="<%=rootPath%>/common/images/right_t_01.jpg"
																									width="5" height="29" />
																							</td>
																							<td align='center' height="29"
																								class="content-title"
																								style="text-align: center;">
																								<b>关键业务</b>
																							</td>
																							<td align="right">
																								<img
																									src="<%=rootPath%>/common/images/right_t_03.jpg"
																									width="5" height="29" />
																							</td>
																						<tr>
																					</table>
																				</td>
																			</tr>
																			<tr>
																				<td>
																					<table>
																						<tr align="center">
																							<!-- 数据库、网络设备、服务器等 -->
																							<%
																								Iterator iterator = bussinessviewHash.keySet().iterator();
																								int num = 0;
																								int maxnum = 9;//最大允许显示的个数 
																								int index = 0;//已经显示的个数
																								while (iterator.hasNext()) {
																									num++;
																									index++;
																									if (index > maxnum) {
																										break;
																									}
																									ManageXml manageXml = (ManageXml) iterator.next();
																									String toponame = manageXml.getTopoName();
																									int alarmstatus = 0;
																									List nodeList = (ArrayList) bussinessviewHash.get(manageXml);
																									String imgname = "bussiness.gif";
																									if (nodeList != null) {
																										for (int i = 0; i < nodeList.size(); i++) {
																											com.afunms.polling.base.Node nodeDTO = (com.afunms.polling.base.Node) nodeList
																													.get(i);
																											int status = nodeDTO.getAlarmlevel();
																											if (status > alarmstatus) {
																												alarmstatus = status;
																												imgname = "bussiness_alarm.gif";
																											}
																										}
																									}
																									if (num > 3) {
																										num = 1;
																							%>
																						</tr>
																						<tr>
																							<td>
																								<div style="height: 50px;"></div>
																							</td>
																						</tr>
																						<!-- 每行三个业务视图 -->
																						<tr align="center">
																							<%
																								}
																							%>
																							<td align="center" valign="top">
																								<img
																									src="<%=rootPath + "/resource/image/topo/" + imgname%>">
																								<br>
																								<%-- '<%=rootPath%>/detail/dispatcher.jsp?flag=1&id=bus4' --%>
																								<%
																									String rightFramePath = "/detail/dispatcher.jsp?flag=1&id=bus"
																												+ manageXml.getId();
																								%>
																								<a href="javascript:void(0);"
																									onclick="showTree('<%=rightFramePath%>');"><%=toponame%></a>
																							</td>
																							<%
																								}
																							%>
																						</tr>
																					</table>
																				</td>
																			</tr>
																			<tr valign="bottom">
																				<td>
																					<table id="content-footer" class="content-footer">
																						<tr>
																							<td>
																								<table width="100%" border="0" cellspacing="0"
																									cellpadding="0">
																									<tr>
																										<td align="left" valign="bottom">
																											<img
																												src="<%=rootPath%>/common/images/right_b_01.jpg"
																												width="5" height="12" />
																										</td>
																										<td></td>
																										<td align="right" valign="bottom">
																											<img
																												src="<%=rootPath%>/common/images/right_b_03.jpg"
																												width="5" height="12" />
																										</td>
																									</tr>
																								</table>
																							</td>
																						</tr>
																					</table>
																				</td>
																			</tr>
																		</table>
																	</td>
																</tr>
															</table>
														</td>
													</tr>
													<tr style="height: 7px; background-color: #ababab;">
														<td>
															<div></div>
														</td>
													</tr>
													<!--网络拓扑图和设备性能 -->
													<tr>
														<td>
															<table>
																<tr>
																	<!-- 网络拓扑图  -->
																	<td width=50% align='center' height="270">
																		<table width=100% height="100%" border="0"
																			align='center'>
																			<tr>
																				<td align='center' height="24">
																					<table id="content-header" class="content-header">
																						<tr>
																							<td align="left" width="5">
																								<img
																									src="<%=rootPath%>/common/images/right_t_01.jpg"
																									width="5" height="29" />
																							</td>
																							<td align='center' height="29"
																								class="content-title"
																								style="text-align: center;">
																								<b>网络拓扑图-<%=topo_name%></b>
																							</td>
																							<td align="right">
																								<img
																									src="<%=rootPath%>/common/images/right_t_03.jpg"
																									width="5" height="29" />
																							</td>
																						<tr>
																					</table>
																				</td>
																			</tr>
																			<tr>
																				<td align='center'>
																					<iframe name="topo_Frame"
																						src="<%=rootPath%>/topology/network/h_showMap.jsp?zoom=<%=zoom%>"
																						width="99%" height="99%" scrolling="No"
																						frameborder="0" noresize></iframe>
																				</td>
																			</tr>
																			<tr valign="bottom" style="height: 4px;">
																				<td>
																					<table id="content-footer" class="content-footer">
																						<tr>
																							<td>
																								<table width="100%" border="0" cellspacing="0"
																									cellpadding="0">
																									<tr>
																										<td align="left" valign="bottom">
																											<img
																												src="<%=rootPath%>/common/images/right_b_01.jpg"
																												width="5" height="12" />
																										</td>
																										<td></td>
																										<td align="right" valign="bottom">
																											<img
																												src="<%=rootPath%>/common/images/right_b_03.jpg"
																												width="5" height="12" />
																										</td>
																									</tr>
																								</table>
																							</td>
																						</tr>
																					</table>
																				</td>
																			</tr>
																		</table>
																	</td>
																	<td style="background-color: #ababab;">
																		&nbsp;
																	</td>
																	<!-- 设备性能 -->
																	<td width=50% align='center' height="270">
																		<table width=100% height="100%" border="0"
																			align='center'>
																			<tr>
																				<td id='devicexn_title' align='center' height="24">
																					<table id="content-header" class="content-header">
																						<tr>
																							<td align="left" width="5">
																								<img
																									src="<%=rootPath%>/common/images/right_t_01.jpg"
																									width="5" height="29" />
																							</td>
																							<td align='center' height="29"
																								class="content-title"
																								style="text-align: center;">
																								<b>性能</b>
																							</td>
																							<td align="right">
																								<img
																									src="<%=rootPath%>/common/images/right_t_03.jpg"
																									width="5" height="29" />
																							</td>
																						<tr>
																					</table>
																				</td>
																			</tr>
																			<tr id="tab_list_tr">
																				<td>
																					<!-- EXT的做的TAB 详见home.js文件 -->
																					<!-- 加重点资源Tab页 -->
																					<div id="tab_list" style="width: 100%;"></div>
																				</td>
																			</tr>
																			<tr valign="bottom">
																				<td>
																					<table id="content-footer" class="content-footer">
																						<tr>
																							<td>
																								<table width="100%" border="0" cellspacing="0"
																									cellpadding="0">
																									<tr>
																										<td align="left" valign="bottom">
																											<img
																												src="<%=rootPath%>/common/images/right_b_01.jpg"
																												width="5" height="12" />
																										</td>
																										<td></td>
																										<td align="right" valign="bottom">
																											<img
																												src="<%=rootPath%>/common/images/right_b_03.jpg"
																												width="5" height="12" />
																										</td>
																									</tr>
																								</table>
																							</td>
																						</tr>
																					</table>
																				</td>
																			</tr>
																		</table>
																	</td>
																	<%--
			          			            						<td width=49% align='center' height="300">
								          			                <%
																        if(mxvo!=null){
																    %>
																        <table width=100%  height="100%" border="1" align='center'>
									          			                    <tr>
																				<td align='center' height="24"><b><%=mxvo.getTopoName()%></b></td>
															              	</tr>
													              			<tr> 
													                			<td align='center'> 
													                				<div id="flashcontent_0">
																						<strong>You need to upgrade your Flash Player</strong>
																					</div>
																					<script type="text/javascript">
																					    var so = new SWFObject("<%=rootPath%>/flex/h_topo.swf?xml=<%=mxvo.getXmlName().replace("jsp","xml")%>&toponame=<%=mxvo.getTopoName()%>&x=<%=mxvo.getPercent()%>&y=<%=mxvo.getPercent()%>", "h_topo", "99%", "99%", "8", "#ffffff");
																						so.write("flashcontent_0");
																					</script> 				
													                			</td>
													              			</tr>
													            		</table>
																    <%    
																        } else {
																    %>
																        <table width=100%  height="100%" border="1" align='center'>
													              			<tr> 
													                			<td align='center'> 
													                				<div id="flashcontent_0">
																						<strong>You need to upgrade your Flash Player</strong>
																					</div>
																					<script type="text/javascript">
																					    var so = new SWFObject("<%=rootPath%>/flex/equip_alarm_List.swf", "equip_alarm_List", "99%", "99%", "8", "#ffffff");
																						so.write("flashcontent_0");
																					</script> 				
													                			</td>
													              			</tr>
													            		</table>
																    <%
																        }
																    %>
			          			            						</td>--%>
																</tr>
															</table>
														</td>
													</tr>
													<tr style="height: 7px;">
														<td>
															<div></div>
														</td>
													</tr>
													<tr>
														<!-- 告警信息汇总 -->
														<td align='center' height="24" colspan="2">
															<table id="content-header" class="content-header">
																<tr>
																	<td align="left" width="5">
																		<img src="<%=rootPath%>/common/images/right_t_01.jpg"
																			width="5" height="29" />
																	</td>
																	<td align='center' height="29" class="content-title"
																		style="text-align: center;">
																		<b>告警汇总信息</b>
																	</td>
																	<td align="right">
																		<img src="<%=rootPath%>/common/images/right_t_03.jpg"
																			width="5" height="29" />
																	</td>
																<tr>
															</table>
														</td>
													</tr>
													<tr>
														<td bgcolor="#FFFFFF">
															<table>
																<%-- --%>
																<tr>
																	<td valign=top>
																		<table>
																			<tr>
																				<td align=center>
																					<div id="pie">
																						<!--  <strong>You need to upgrade your Flash Player</strong>-->
																					</div>

																					<script type="text/javascript">
																		<% if(!piedata.equals("0")){ %>	
																			// <![CDATA[	
																			var so = new SWFObject("<%=rootPath%>/amchart/ampie.swf", "ampie","380", "280", "8", "#FFFFFF");
																			so.addVariable("path", "<%=rootPath%>/amchart/");
																			so.addVariable("settings_file", escape("<%=rootPath%>/amcharts_settings/alarmStatepie.xml"));
																			so.addVariable("chart_data","<%=piedata%>");
																			so.write("pie");
																			// ]]>
																			<%}else{%>
																			var _div=document.getElementById("pie");
																			var img=document.createElement("img");
																			img.setAttribute("src","<%=rootPath%>/resource/image/nodata.gif");
																			_div.appendChild(img);
																			<%}%>
																		</script>
																				</td>
																			</tr>
																			<tr>
																				<td>
																					<table>
																						<tr>
																							<td width=60>
																							</td>
																							<td>
																								<img
																									src="<%=rootPath%>/resource/image/jfreechart/reportimg/<%=closedAlarmPicFile%>"
																									id="closedAlarmPicFile">
																							</td>
																						</tr>
																					</table>
																				</td>
																			</tr>
																		</table>
																	</td>
																	<td valign=top>
																		<table>
																			<tr>
																				<td>
																					<table cellpadding=8 height=296 border="1"
																						bordercolor="#7599d7"
																						style="border: 1px solid #7599d7; border-collapse: collapse;">

																						<%
																							for (int i = 0; i < tableData.length; i++) {
																						%>
																						<tr>
																							<%
																								for (int j = 0; j < tableData[i].length; j++) {
																										if (j == 0) {
																							%>
																							<td width="80" height="25" align=center><%=tableData[i][j]%></td>
																							<%
																								} else if (i == 0 && j == 1) {//普通
																							%>
																							<td width="60" height="25" align=center
																								bgcolor="blue"><%=tableData[i][j]%></td>
																							<%
																								} else if (i == 0 && j == 2) {//严重
																							%>
																							<td width="60" height="25" align=center
																								bgcolor="yellow"><%=tableData[i][j]%></td>
																							<%
																								} else if (i == 0 && j == 3) {//紧急
																							%>
																							<td width="60" height="25" align=center
																								bgcolor="orange"><%=tableData[i][j]%></td>
																							<%
																								} else if (i == 0 && j == 4) {//紧急
																							%>
																							<td width="60" height="25" align=center
																								bgcolor="red"><%=tableData[i][j]%></td>
																							<%
																								} else {
																							%>
																							<td width="60" height="25" align=center><%=tableData[i][j]%></td>
																							<%
																								}
																									}
																							%>
																						</tr>
																						<%
																							}
																						%>
																					</table>
																				</td>
																			</tr>
																			<tr>
																				<td>
																					<div id="column">
																						<strong>You need to upgrade your Flash
																							Player</strong>
																					</div>
																					<script type="text/javascript">
																			// <![CDATA[		
																			var so = new SWFObject("<%=rootPath%>/amchart/amcolumn.swf", "amcolumn","480", "320", "8", "#FFFFF");
																			so.addVariable("path", "<%=rootPath%>/amchart/");
																			so.addVariable("settings_file", escape("<%=rootPath%>/amcharts_settings/lastweekColumn.xml"));
																			so.addVariable("chart_data", "<%=columndata%>");
																			so.write("column");
																			// ]]>
																		</script>
																				</td>
																			<tr>
																		</table>
																	</td>
																	<td>
																		<table>
																			<tr>
																				<td>
																					<div id="lineOne">
																						<strong>You need to upgrade your Flash
																							Player</strong>
																					</div>
																					<script type="text/javascript">
																		// <![CDATA[		
																		var so = new SWFObject("<%=rootPath%>/amchart/amline.swf", "amline","280", "300", "8", "#FFFFFF");
																		so.addVariable("path", "<%=rootPath%>/amchart/");
																		so.addVariable("settings_file", escape("<%=rootPath%>/amcharts_settings/dayalarm_setting.xml"));
																		so.addVariable("chart_data", "<%=dayalarmData%>");
																		so.write("lineOne");
																		// ]]>
																		</script>
																				</td>
																			</tr>
																			<tr>
																				<td>
																					<div id="lineTwo">
																						<strong>You need to upgrade your Flash
																							Player</strong>
																					</div>
																					<script type="text/javascript">
																			// <![CDATA[		
																			var so = new SWFObject("<%=rootPath%>/amchart/amline.swf", "amline","280", "300", "8", "#FFFFFF");
																			so.addVariable("path", "<%=rootPath%>/amchart/");
																			so.addVariable("settings_file", escape("<%=rootPath%>/amcharts_settings/weekalarm_settings.xml"));
																			so.addVariable("chart_data", "<%=weekalarmData%>");
																			so.write("lineTwo");
																			// ]]>
																		</script>
																				</td>
																			</tr>
																		</table>
																	</td>
																</tr>
															</table>
															<!-- 1*2 -->
														</td>
													</tr>
													<tr valign="bottom">
														<td>
															<table id="content-footer" class="content-footer">
																<tr>
																	<td>
																		<table width="100%" border="0" cellspacing="0"
																			cellpadding="0">
																			<tr>
																				<td align="left" valign="bottom">
																					<img
																						src="<%=rootPath%>/common/images/right_b_01.jpg"
																						width="5" height="12" />
																				</td>
																				<td></td>
																				<td align="right" valign="bottom">
																					<img
																						src="<%=rootPath%>/common/images/right_b_03.jpg"
																						width="5" height="12" />
																				</td>
																			</tr>
																		</table>
																	</td>
																</tr>
															</table>
														</td>
													</tr>
													<!--
										<tr>
								          	<td width=100% colspan=3>
								          		<table width="100%" align='center'>
								              		<tr> 
				                						<td align='center'> 
				                							<div id="flashcontent_yewu1">
														       <strong>You need to upgrade your Flash Player</strong>
													        </div>
								          	                <script type="text/javascript">
									                            var so = new SWFObject("<%=rootPath%>/flex/NetworkTopology.swf", "NetworkTopology", "99%", "280", "9", "#FFFFFF");
									                            so.write("flashcontent_yewu1");
								                            </script>
								                        </td>
								              		</tr>
							            		</table>
							          	    </td>
							          	</tr>
									-->
													<%-- 
										          	<% 
										          		if(networklist != null && networklist.size()>0){
										          	%>
									           		<tr>
									           			<td>
									           				<table width=100%>
									           					<tr>
												          			<td width="33%" align=center>
												            			<table width="100%" height="220">
												              				<tr> 
												                				<td  align=center> 
									                								<div id="flashcontent2">
																						<strong>You need to upgrade your Flash Player</strong>
																					</div>
																					<script type="text/javascript">
																						var so = new SWFObject("<%=rootPath%>/flex/Column_Network_CPU_TOP10.swf", "Column_Network_Cpu_Top10", "99%", "99%", "8", "#ffffff");
																						so.write("flashcontent2");
																					</script>
																				</td>
																			</tr>
																        </table>
																    </td>
																    <td width="33%" align=center>
																		<table width=100% height="220">
																			<tr> 
																				<td width="100%" > 
																					<div id="flashcontent3">
																						<strong>You need to upgrade your Flash Player</strong>
																					</div>
																					<script type="text/javascript">
																						var so = new SWFObject("<%=rootPath%>/flex/Column_Network_In_TOP10.swf", "Column_Network_In_TOP10", "99%", "99%", "8", "#ffffff");
																						so.write("flashcontent3");
																					</script>				
																				</td>
																			</tr>             
																		</table> 
																	</td>
																	<td width="33%" align=center>
														          		<table width=100% height="220">
														              		<tr> 
														                		<td width="100%"> 
														                			<div id="flashcontent4">
																						<strong>You need to upgrade your Flash Player</strong>
																					</div>
																					<script type="text/javascript">
																						var so = new SWFObject("<%=rootPath%>/flex/Column_Network_Out_TOP10.swf", "Column_Network_Out_TOP10", "99%", "99%", "8", "#ffffff");
																						so.write("flashcontent4");
																					</script>				
														                		</td>
														              		</tr>             
														            	</table> 
														          	</td>
									          					</tr>
									          				</table>
									          			</td>
									          		</tr>
											 		<%
											 			}
											 			if(hostlist != null && hostlist.size()>0){
											 		%>
									 				<tr>
									 					<td>
									 						<table width=100%>
									 							<tr>
																	<td width="33%" align=center>
																		<table width="100%" height="400" cellpadding="0" cellspacing="0">
																			<tr> 
																				<td align=center> 
																					<div id="flashcontent5">
																						<strong>You need to upgrade your Flash Player</strong>
																					</div>
																					<script type="text/javascript">
																						var so = new SWFObject("<%=rootPath%>/flex/Column_Host_CPU_TOP10.swf", "Column_Host_CPU_TOP10", "99%", "99%", "8", "#ffffff");
																						so.write("flashcontent5");
																					</script>
																				</td>
																			</tr>
																		</table>
																	</td>
																	<td width="33%" align=center>
																		<table cellpadding="0" cellspacing="0" width=100% height="220">
																			<tr> 
																				<td align=center> 
																					<div id="flashcontent6">
																						<strong>You need to upgrade your Flash Player</strong>
																					</div>
																					<script type="text/javascript">
																						var so = new SWFObject("<%=rootPath%>/flex/Column_Host_Memory_TOP10.swf", "Column_Host_Memory_TOP10", "99%", "99%", "8", "#ffffff");
																						so.write("flashcontent6");
																					</script>			
																				</td>
																			</tr>             
																		</table> 
																	</td>
																	<td width="33%" align=center>
																		<table cellpadding="0" cellspacing="0" width=100% height="220">
																			<tr> 
																				<td align=center> 
																					<div id="flashcontent7">
																						<strong>You need to upgrade your Flash Player</strong>
																					</div>
																					<script type="text/javascript">
																						var so = new SWFObject("<%=rootPath%>/flex/Column_Host_Disk_TOP10.swf", "Column_Host_Disk_TOP10", "99%", "99%", "8", "#ffffff");
																						so.write("flashcontent7");
																					</script>				
																				</td>
																			</tr>             
																		</table> 
																	</td>
																</tr>
															</table>
														</td>
													</tr> 
											 		<%
											 			}
											 		%>
											 		--%>
												</table>
											</td>
										</tr>
										<%--
										<tr>
											<td>
												<table id="content-footer" class="content-footer">
													<tr>
														<td>
															<table width="100%" border="0" cellspacing="0"
																cellpadding="0">
																<tr>
																	<td align="left" valign="bottom">
																		<img src="<%=rootPath%>/common/images/right_b_01.jpg"
																			width="5" height="12" />
																	</td>
																	<td></td>
																	<td align="right" valign="bottom">
																		<img src="<%=rootPath%>/common/images/right_b_03.jpg"
																			width="5" height="12" />
																	</td>
																</tr>
															</table>
														</td>
													</tr>
												</table>
											</td>
										</tr>--%>
									</table>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</form>
		<script type="text/javascript">
			Ext.onReady(tabpanel_var('<%=rootPath%>'));
			
			//构建一个JavaScript的replaceAll方法  （该方法个别客户机浏览器不支持）
			//String.prototype.replaceAll  = function(s1,s2){    
			//  	return this.replace(new RegExp(s1,"gm"),s2);   
			//} 
			
			/**
			*跳转到性能页面
			*/
			function showTree(rightFramePath){
				//将等于和and转换一下  
				//rightFramePath = rightFramePath.replaceAll("&","-and-");
				//rightFramePath = rightFramePath.replaceAll("=","-equals-");
				//使用循环，将等于和and转换一下  
				while(rightFramePath.indexOf("&") != -1){
					rightFramePath = rightFramePath.replace("&","-and-");
				}
				while(rightFramePath.indexOf("=") != -1){
					rightFramePath = rightFramePath.replace("=","-equals-");
				}
				//alert(rightFramePath);
				window.location.href =  "<%=rootPath%>/performance/index.jsp?flag=1&rightFramePath="+rightFramePath;
			}
		</script>
	</body>
</html>
